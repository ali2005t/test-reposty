<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الطلاب - Ta3leemy</title>

    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

    <div class="dashboard-layout">

        <!-- Sidebar -->
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header"><a href="#" class="logo">Ta3leemy</a></div>
            <div class="sidebar-menu">
                <div class="menu-item" onclick="window.location.href='dashboard.html'"><i class="fas fa-home"></i>
                    الرئيسية</div>
                <div class="menu-item" onclick="window.location.href='trainings.html'"><i
                        class="fas fa-layer-group"></i> الدورات</div>
                <div class="menu-item" onclick="window.location.href='lectures.html'"><i class="fas fa-video"></i>
                    المحاضرات</div>
                <div class="menu-item" onclick="window.location.href='exams.html'"><i
                        class="fas fa-clipboard-check"></i> الامتحانات</div>
                <div class="menu-item" onclick="window.location.href='exam-results.html'"><i class="fas fa-poll"></i>
                    النتائج والتصحيح</div>
                <div class="menu-item active" onclick="window.location.href='students.html'"><i
                        class="fas fa-users"></i>
                    الطلاب</div>
                <div class="menu-item" onclick="window.location.href='generate-codes.html'"><i
                        class="fas fa-barcode"></i> الأكواد</div>
                <div class="menu-item" onclick="window.location.href='manual-access.html'"><i
                        class="fas fa-lock-open"></i> فتح المحتوى للطالب</div>

                <!-- Accounts Submenu -->
                <div class="menu-item" onclick="toggleSubmenu('accounts-submenu')"
                    style="display:flex; justify-content:space-between; align-items:center; cursor:pointer;">
                    <span><i class="fas fa-wallet"></i> الحسابات</span>
                    <i class="fas fa-chevron-down" style="font-size:0.8rem;"></i>
                </div>
                <div id="accounts-submenu" style="display:none; background:rgba(0,0,0,0.2); padding-right:15px;">
                    <div class="menu-item" onclick="window.location.href='permissions.html'"
                        style="font-size:0.9rem; padding:10px;"><i class="fas fa-file-invoice-dollar"></i> الأذونات
                    </div>
                    <div class="menu-item" onclick="window.location.href='invoices.html'"
                        style="font-size:0.9rem; padding:10px;"><i class="fas fa-file-invoice"></i> الفواتير</div>
                    <div class="menu-item" onclick="window.location.href='subscriptions.html'"
                        style="font-size:0.9rem; padding:10px;"><i class="fas fa-box-open"></i> الاشتراكات</div>
                </div>

                <div class="menu-item" onclick="window.location.href='app-settings.html'">
                    <i class="fas fa-mobile-alt"></i> تجهيز التطبيق
                </div>

                <div class="menu-item" onclick="window.location.href='support.html'"><i class="fas fa-headset"></i>
                    الدعم الفني</div>

                <!-- Settings Submenu -->
                <div class="menu-item" onclick="toggleSubmenu('settings-submenu')"
                    style="margin-top:auto; border-top:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center; cursor:pointer;">
                    <span><i class="fas fa-cog"></i> الإعدادات</span>
                    <i class="fas fa-chevron-down" style="font-size:0.8rem;"></i>
                </div>
                <div id="settings-submenu"
                    style="display:none; background:rgba(0,0,0,0.2); padding-right:15px; margin-bottom:1rem;">
                    <div class="menu-item" onclick="window.location.href='settings.html'"
                        style="font-size:0.9rem; padding:10px;"><i class="fas fa-sliders-h"></i> إعدادات المنصة</div>
                    <div class="menu-item" onclick="window.location.href='notifications.html'"
                        style="font-size:0.9rem; padding:10px;"><i class="fas fa-bell"></i> الإشعارات</div>
                    <div class="menu-item" onclick="window.location.href='profile.html'"
                        style="font-size:0.9rem; padding:10px;"><i class="fas fa-user-circle"></i> الملف الشخصي</div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar-redesigned"
                style="display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; background: #0f172a; border-bottom: 1px solid #1e293b;">
                <!-- Right: Title & Hamburger -->
                <div class="header-right" style="display:flex; align-items:center; gap:15px;">
                    <button class="btn-icon mobile-only" id="open-sidebar"
                        style="background:transparent; border:none; color:white; font-size:1.2rem; cursor:pointer;"><i
                            class="fas fa-bars"></i></button>
                    <div class="header-title">
                        <h3 style="margin:0; color:white; font-size:1.2rem;">الطلاب</h3>
                    </div>
                </div>

                <!-- Left: Actions -->
                <div class="top-actions" style="display:flex; align-items:center; gap:20px;">

                    <!-- Site Link -->
                    <a href="#" class="action-link mobile-hide" target="_blank" id="site-link"
                        style="color:#94a3b8; text-decoration:none; display:flex; align-items:center; gap:5px; transition:color 0.2s;">
                        <i class="fas fa-external-link-alt"></i> <span class="mobile-hide">الموقع</span>
                    </a>

                    <!-- Notifications -->
                    <div class="notification-container" style="position:relative;">
                        <div class="notification-bell" id="notif-bell-trigger"
                            style="cursor:pointer; position:relative;">
                            <i class="fas fa-bell" style="font-size:1.2rem; color:#94a3b8; transition:color 0.2s;"></i>
                            <span class="badge-count"
                                style="position:absolute; top:-8px; right:-5px; background:#ef4444; color:white; border-radius:50%; font-size:0.7rem; padding:2px 6px; border:2px solid #0f172a;">3</span>
                        </div>

                        <!-- Notifications Dropdown -->
                        <div class="custom-dropdown" id="notif-dropdown"
                            style="display:none; position:absolute; left:-10px; top:50px; background:#1e293b; border:1px solid #334155; border-radius:12px; width:320px; z-index:1000; box-shadow:0 20px 25px -5px rgba(0,0,0,0.3); overflow:hidden;">
                            <div
                                style="padding:15px; border-bottom:1px solid #334155; font-weight:bold; color:white; display:flex; justify-content:space-between; align-items:center;">
                                <span>الإشعارات</span>
                                <span style="font-size:0.8rem; color:#6366f1; cursor:pointer;">تحديد الكل كمقروء</span>
                            </div>
                            <div class="notif-list" style="max-height:350px; overflow-y:auto;">
                                <!-- Mock Notifs -->
                                <div class="notif-item"
                                    style="padding:15px; border-bottom:1px solid #334155; color:#cbd5e1; font-size:0.9rem; transition:background 0.2s; cursor:pointer;">
                                    <div
                                        style="font-weight:bold; color:#f1f5f9; margin-bottom:5px; display:flex; align-items:center; gap:8px;">
                                        <i class="fas fa-info-circle" style="color:#60a5fa;"></i> إشعار إداري
                                    </div>
                                    <p style="margin:0; font-size:0.85rem; line-height:1.4;">تم تفعيل حسابك بنجاح.</p>
                                    <div style="font-size:0.75rem; color:#64748b; margin-top:8px;">منذ 2 ساعة</div>
                                </div>
                            </div>
                            <a href="#"
                                style="display:block; padding:12px; text-align:center; color:#6366f1; text-decoration:none; font-size:0.9rem; font-weight:600; background:#1e293b;">عرض
                                كل الإشعارات</a>
                        </div>
                    </div>

                    <!-- Profile Dropdown Trigger -->
                    <div class="profile-container" style="position:relative;">
                        <div class="profile-trigger" id="profile-widget-trigger"
                            style="display:flex; align-items:center; gap:12px; cursor:pointer; padding:5px; border-radius:8px; transition:background 0.2s;">
                            <div class="avatar"
                                style="width:40px; height:40px; background:linear-gradient(135deg, #6366f1, #8b5cf6); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:1.1rem; box-shadow:0 4px 6px -1px rgba(99, 102, 241, 0.3);">
                                <span id="user-avatar-char">T</span>
                            </div>
                            <div class="info mobile-hide" style="text-align:right;">
                                <div id="user-name" style="font-weight:bold; color:white; font-size:0.9rem;">المعلم
                                </div>
                                <div style="font-size:0.75rem; color:#94a3b8;">محاضر</div>
                            </div>
                            <i class="fas fa-chevron-down mobile-hide" style="font-size:0.8rem; color:#94a3b8;"></i>
                        </div>

                        <!-- Profile Dropdown Menu -->
                        <div class="custom-dropdown" id="profile-dropdown-menu"
                            style="display:none; position:absolute; left:0; top:60px; background:#1e293b; border:1px solid #334155; border-radius:12px; width:220px; z-index:1000; box-shadow:0 20px 25px -5px rgba(0,0,0,0.3); overflow:hidden;">
                            <a href="profile.html" class="dropdown-item"
                                style="display:flex; gap:10px; padding:12px 15px; color:#cbd5e1; text-decoration:none; border-bottom:1px solid #334155; align-items:center; transition:background 0.2s;">
                                <i class="fas fa-user-circle" style="width:20px; text-align:center;"></i> الحساب الشخصي
                            </a>
                            <a href="subscriptions.html" class="dropdown-item"
                                style="display:flex; gap:10px; padding:12px 15px; color:#cbd5e1; text-decoration:none; border-bottom:1px solid #334155; align-items:center; transition:background 0.2s;">
                                <i class="fas fa-box-open" style="width:20px; text-align:center;"></i> الاشتراكات
                            </a>
                            <a href="profile.html" class="dropdown-item"
                                style="display:flex; gap:10px; padding:12px 15px; color:#cbd5e1; text-decoration:none; border-bottom:1px solid #334155; align-items:center; transition:background 0.2s;">
                                <i class="fas fa-cog" style="width:20px; text-align:center;"></i> الإعدادات
                            </a>
                            <a href="#" id="logout-link-dropdown" class="dropdown-item"
                                style="display:flex; gap:10px; padding:12px 15px; color:#ef4444; text-decoration:none; align-items:center; transition:background 0.2s; font-weight:600;">
                                <i class="fas fa-power-off" style="width:20px; text-align:center;"></i> تسجيل الخروج
                            </a>
                        </div>
                    </div>

                </div>
            </header>

            <div class="page-content">
                <div class="filters-bar">
                    <div class="search-input-group">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-students" class="form-input"
                            placeholder="بحث بالاسم أو رقم الهاتف...">
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="25%">اسم الطالب</th>
                                <th width="20%">رقم الهاتف</th>
                                <th width="25%">البريد الإلكتروني</th>
                                <th width="15%">تاريخ الانضمام</th>
                                <th width="10%">الأوامر</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                            <!-- Rows -->
                        </tbody>
                    </table>
                    <div id="loading-indicator" class="loading-state"><i class="fas fa-spinner fa-spin"></i> جاري
                        التحميل...
                    </div>
                    <div id="empty-state" class="empty-state" style="display: none; background:none; border:none;">
                        <p>لا يوجد طلاب مشتركين بعد</p>
                    </div>
                </div>
            </div>

            <!-- Script for Header Interactions -->
            <script type="module">
                import { auth } from '../assets/js/firebase-config.js';
                import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
                import { initHeader } from '../assets/js/header-manager.js';

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        initHeader(user);
                    }
                });
            </script>
        </main>
    </div>

    < !--Row Template-->
        <template id="student-row-template">
            <tr>
                <td class="row-index">1</td>
                <td class="row-name" style="font-weight:bold; color:white;">اسم الطالب</td>
                <td class="row-phone" style="direction:ltr; text-align:right;">010xxxxxxxx</td>
                <td class="col-meta row-email">email@example.com</td>
                <td class="col-meta row-date">2025/01/01</td>
                <td>
                    <div class="action-dropdown">
                        <button class="btn-icon-menu"><i class="fas fa-ellipsis-v"></i></button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item btn-profile"><i class="fas fa-eye"></i> الملف الشخصي</button>
                            <button class="dropdown-item btn-grant-access" style="color:#3b82f6;"><i
                                    class="fas fa-key"></i>
                                منح صلاحية</button>
                            <button class="dropdown-item btn-reset-device"><i class="fas fa-mobile-alt"></i> إعادة ضبط
                                الجهاز</button>
                            <button class="dropdown-item danger btn-ban"><i class="fas fa-ban"></i> حظر الحساب</button>
                        </div>
                    </div>
                </td>
            </tr>
        </template>

        <script src="../assets/js/ui-manager.js"></script>
        <script type="module" src="../assets/js/firebase-config.js"></script>

        <script type="module" src="../assets/js/students.js?v=1"></script>
        <script type="module" src="../assets/js/dashboard.js"></script> <!-- Reusing sidebar logic -->
        <div class="floating-btns-container">
            <button class="float-btn ticket" onclick="alert('فتح تذكرة دعم جديدة')">
                <i class="fas fa-ticket-alt"></i> تذاكر الدعم
            </button>
            <button class="float-btn" onclick="window.location.href='https://wa.me/?text=help'">
                تواصل معنا <i class="fab fa-whatsapp"></i>
            </button>
        </div>
        <style>
            .floating-btns-container {
                position: fixed;
                bottom: 20px;
                left: 20px;
                display: flex;
                flex-direction: column;
                gap: 10px;
                z-index: 9999;
            }

            .float-btn {
                background: #6366f1;
                color: white;
                padding: 10px 20px;
                border-radius: 50px;
                box-shadow: 0 4px 10px rgba(99, 102, 241, 0.4);
                cursor: pointer;
                border: none;
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: bold;
                transition: transform 0.2s;
                font-family: inherit;
            }

            .float-btn:hover {
                transform: translateY(-2px);
            }

            .float-btn.ticket {
                background: #8b5cf6;
            }
        </style>

</body>

</html>